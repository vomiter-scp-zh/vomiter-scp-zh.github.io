<head>
	<script language="JavaScript">
		function AddSMTH () {
			var textarea = document.getElementById("test");
			if (textarea.selectionStart === undefined) {	// Internet Explorer
					// create a range from the current selection
				var textRange = document.selection.createRange ();
					// check whether the selection is inside the textarea element
				var rangeParent = textRange.parentElement ();
				if (rangeParent && rangeParent.id == "test") {
						// add [smth] around the selected text
					textRange.text = "[smth]" + textRange.text + "[/smth]";

				}
			}
			else {
					// check whether some text is selected inside the textarea element
				if (textarea.selectionStart != textarea.selectionEnd) {
					var newText = textarea.value.substring (0, textarea.selectionStart) + 
								"[smth]" + textarea.value.substring  (textarea.selectionStart, textarea.selectionEnd) + "[/smth]" +
								textarea.value.substring (textarea.selectionEnd);
					textarea.value = newText;
				}
			}
		}
	</script>
</head>
<body>
	<textarea id="test" spellcheck="false">Some text in a textarea.</textarea>
	<button onclick="AddSMTH ()">Add smth around the selection</button>
</body>